#On Action Overwrite

on_startup = {
	if = {
		limit = {
			current_age = age_of_discovery
		}
		LXA = {
			if = {
				limit = {
					NOT = { has_country_flag = lxa_loyalty_flag }
				}
				add_estate_loyalty = {
					estate = estate_church
					loyalty = -10
				}
				set_country_flag = lxa_loyalty_flag
			}
		}
	}
	emperor = {
		save_global_event_target_as = Emperor
	}
	set_global_flag = empire_of_china_dismantled
	if = {
		limit = {
			is_emperor_of_china = yes
		}
		save_global_event_target_as = EmperorOfChina
	}
	events = {
		#vanilla events
		muslim_school_events.20 #Pick School
		flavor_got.1 #Event for Gotland to select their mission tree
		flavor_mng.42 #Event for the starting situation of the Ming 
		#flavor_fra.15000 #Make the French Revolution happen if starting in 1789
		flavor_mos.1 #Event regarding the Tatar Yoke
		
		christian_school_events.20
		christian_school_events.21 #pick reformed denomination
		eastern_school_events.20
		
		mr_startup_events.1000
		
		#lore context events
		mr_startup_events.1
		mr_startup_events.2
		mr_startup_events.3
		mr_startup_events.4
		HUN_flavor.2
	#flavor_fra.15000 #Make the French Revolution happen if starting in 1789
	}
	if = {
		limit = {
			has_dlc = "Cradle of Civilization"
			has_country_modifier = tur_janissary
		}
		remove_country_modifier = tur_janissary
	}
	initialize_schools_effect = yes #This is only used here but is used for readability of on_action file.

	if = {
		limit = {
			NOT = { has_country_flag = new_flavour_bav_13_has_been_triggered }
			OR = {
				tag = UBV
				tag = LBV
				tag = ING
			}
		}
		set_country_flag = new_flavour_bav_13_has_been_triggered
		country_event = { id = new_flavour_bav.13 days = 90 } #better not to allow almost instant DOWs
	}
	if = {
		limit = {
			tag = FRA
			started_in = 1789.7.14
			NOT = { is_year = 1790 }
			NOT = { has_disaster = french_revolution }
		}
		add_disaster_progress = {
			value = 100
			disaster = french_revolution
		}
	}
	if = {
		limit = {
			exists = SUK
		}
		SUK = {
			set_ruler_flag = suk_monarch_flag
		}
		AYU = {
			set_country_flag = ayu_monarch_flag
		}
	}
	#if = {
	#	limit = {
	#		OR = {
	#			primary_culture = norse
	#			AND = {
	#				culture_group = scandinavian
	#				religion = norse_pagan_reformed
	#			}
	#		}
	#		NOT = { has_idea_group = norse_ideas }
	#		is_playing_custom_nation = no
	#	}
	#	country_event = { id = ideagroups.1 } #Swap Ideas
	#}
	if = {
		limit = { 
			has_dlc = "Domination" 
			tag = FRA 
			NOT = { is_year = 1445 } 
		}
		country_event = { id = flavor_fra.206 }
	}
	if = {
		limit = {
			NOT = { has_global_flag = end_of_the_tatar_yoke }
			owns = 466
			is_year = 1480
		}
		set_global_flag = end_of_the_tatar_yoke
	}
	if = {
		limit = {
			OR = {
				has_country_modifier = rise_of_the_ottomans
				has_country_modifier = zenith_of_the_ottomans
				has_country_modifier = twilight_of_the_ottomans
				has_country_modifier = decline_of_the_ottomans
			}
		}
		remove_country_modifier = rise_of_the_ottomans
		remove_country_modifier = zenith_of_the_ottomans
		remove_country_modifier = twilight_of_the_ottomans
		remove_country_modifier = decline_of_the_ottomans
	}
	if = {
		limit = {
			has_government_mechanic = ottoman_decadence_mechanic
			current_age = age_of_discovery
		}
		add_country_modifier = {
			name = rise_of_the_ottomans
			duration = -1
			desc = until_end_of_age_desc
		}
	}
	if = {
		limit = {
			has_government_mechanic = ottoman_decadence_mechanic
			current_age = age_of_reformation
		}
		add_country_modifier = {
			name = zenith_of_the_ottomans
			duration = -1
			desc = until_end_of_age_desc
		}
	}
	if = {
		limit = {
			has_government_mechanic = ottoman_decadence_mechanic
			current_age = age_of_absolutism
		}
		add_country_modifier = {
			name = twilight_of_the_ottomans
			duration = -1
			desc = until_end_of_age_desc
		}
	}
	if = {
		limit = {
			has_government_mechanic = ottoman_decadence_mechanic
			current_age = age_of_revolutions
		}
		add_country_modifier = {
			name = decline_of_the_ottomans
			duration = -1
			desc = until_end_of_age_desc
		}
	}
}

# country
on_religion_change = {
	on_religion_change_estate_privileges_effect = yes
	judaism_on_religion_change_effect = yes
	###removes catholic modifiers
		remove_country_modifier = counter_reformation
		remove_country_modifier = the_statue_in_restraint_of_appeals
		remove_country_modifier = revocation_of_restraint_of_appeals
		remove_country_modifier = bavarian_jesuits
		remove_country_modifier = the_societas_jesu
		remove_country_modifier = the_declaration_of_indulgence
		remove_country_modifier = de_heretico_comburendo
		remove_country_modifier = the_conventicle_act
	if = {
		limit = {
			has_reform = indian_sultanate_reform
			NOT = { religion_group = muslim }
		}
		remove_government_reform = indian_sultanate_reform
	}

	if = {
		limit = {
			has_reform = feudal_theocracy
			NOT = { religion_group = muslim }
			NOT = { religion_group = zoroastrian_group }
		}
		remove_government_reform = feudal_theocracy
	}

	if = {
		limit = {
			government = native
			OR = {
				religion = nahuatl
				religion = mesoamerican_religion
				religion = inti
			}
		}
		change_government = monarchy
		add_government_reform = autocracy_reform
	}


	if = {
		limit = {
			has_heir = yes
		}
		set_heir_religion = ROOT
	}
	if = {
		limit = {
			has_regency = no
		}
		set_ruler_religion = ROOT
	}
	if = {
		limit = {
			has_dlc = "Rights of Man"
			has_consort = yes
		}
		set_consort_religion = ROOT
	}
	if = {
		limit = {
			NOT = { religion = orthodox }
		}
		every_known_country = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = closed_down_the_patriarchate
				}
			}
			reverse_remove_opinion = {
				who = ROOT
				modifier = closed_down_the_patriarchate
			}
		}
	}
	if = {
		limit = {
			religion = catholic
			has_ruler_flag = personal_catholic_sympathies
		}
		country_event = { id = protestantism_events.19 }
	}
	if = {
		limit = {
			religion = protestant
		}
		set_country_flag = converted_to_protestantism
	}
	if = {
		limit = {
			religion = hussite
		}
		remove_country_modifier = hussite_persecution
	}
	if = {
		limit = { has_country_modifier = bav_religious_mandate_mod }
		remove_country_modifier = bav_religious_mandate_mod
	}
	add_country_modifier = {
		name = recently_changed_religion_dummy
		duration = 10
		hidden = yes
	}
	if = {
		limit = {
			NOT = { religion_group = muslim }
			any_owned_province = { has_province_modifier = sufi_shrine }
		}
		every_owned_province = {
			limit = { has_province_modifier = sufi_shrine }
			remove_province_modifier = sufi_shrine
		}
	}
	if = {
		limit = {
			religion = shamanism
			has_country_modifier = son_fetishism_as_secondary_religion
		}
		remove_country_modifier = son_fetishism_as_secondary_religion
		every_owned_province = {
			limit = {
				has_province_modifier = son_fetishism_as_secondary_religion_province
			}
			remove_province_modifier = son_fetishism_as_secondary_religion_province
		}
	}
	if = { 
		limit = { 
			has_country_flag = fra_papal_lap_dop_flag 
		}
		clr_country_flag = fra_papal_lap_dop_flag 
		set_country_flag = fra_chose_to_piss_off_pope_flag
		swap_non_generic_missions = yes 
		remove_country_modifier = fra_catholic_head_of_state_modifier 
		remove_country_modifier = fra_fervent_call_to_arms_modifier 
		clr_country_flag = enable_holy_orders_flag 
		if = { 
			limit = { 
				KOJ = { is_subject_of = ROOT } 
			}
			KOJ = { add_liberty_desire = 25 } 
		}
		remove_country_modifier = fra_sword_of_christianity_modifier
		remove_country_modifier = fra_sword_of_christianity_modifier2
		remove_country_modifier = fra_sword_of_christianity_modifier3
		remove_country_modifier = fra_sword_of_christianity_modifier4
		remove_country_modifier = fra_sword_of_christianity_modifier5
		remove_country_modifier = fra_jerusalem_modifier
	}
	events = {
		muslim_school_events.20 #Pick School
		propagate_religion_events.7 #Propagated Country is now Muslim
	}
	if = {
		limit = {
			religion = mr_cathar
		}
		set_religious_school = {
			group = christian
			school = mr_christian_no_school
		}
	}
	#changes iberian names to original tag name if not muslim
	if = {
		limit = {
			OR = {
				tag = GAL
				tag = LON
				tag = NAV
				tag = CAS
				tag = POR
				tag = BJZ
				tag = SEV
				tag = CBD
				tag = GRA
				tag = VAL
				tag = CAT
				tag = ARA
				tag = MJO
			}
			NOT = { religion_group = muslim }
		}
		restore_country_name = YES
	}
	#change iberian names to islamic name if muslim
	change_iberian_name_to_arabic_effect = yes
	events = {
		muslim_school_events.20 #Pick School
		propagate_religion_events.7 #Propagated Country is now Muslim
		christian_school_events.20 #pick christian rites
		eastern_school_events.20
		christian_school_events.21 #pick reformed denomination
	}
}

on_new_monarch = {
	on_new_monarch_effect = yes
	crimean_succession_effect = yes #Scripted effect
	slesvig_question_effect = yes #Scripted effect
	# ambrosian_republic_effect = yes
	succession_culture_religion_effect = yes
	sheik_ul_islam_effect = yes
	hab_remove_mission_mods_if_not_emperor_effect = yes
	thu_remain_von_wettin_effect = yes
	ladislaus_postumus_union_effect = yes
	events = {
		tribal_succession.1		# Harsh anti-tribals.
		9492 					# Remove some event modifiers
		flavor_boh.8			# Winter King in Prague
		flavor_kol.1			# Bavarian Archbishop
		war_of_the_roses.101	# WotR - House of Lancaster wins
		war_of_the_roses.102	# WotR - House of York wins
		war_of_the_roses.106	# WotR - Another dynasty has seized the throne
		flavor_tur.102			# Janissary Reward
		flavor_ori.7			# Hamvira Victorious
		flavor_kbo.1			# The two branches of the Sayfawa dynasty
		flavor_kbo.8			# Sayfawa pretenders
		flavor_zan.5			# Coup of Coup of Suleiman and Muhammad al-Mazlum.
		purple_phoenix.1		# BYZ pretenders
		flavor_pol.3480			# The Pacta Conventa
		protestantism_events.15	# Catholic Leaning Monarch
		tengri_events.17		# Keep the Khojas in Power?
		flavor_tus.15			# Savonarola Dies
		flavor_brapru.22		# Succession of Albrecht Achilles
		flavor_brapru.25		# Dispositio Achillea (can also trigger from flavor_brapru.22)
		flavor_nor.27			# Proclamation in Hamar
		china_events.43			# Picking new Capital for China
		celestial_empire_events.3 #Resistance to Sinicization
		flavor_boh.2			#Heretic Kings
		flavor_hun.17			#Maintaining the Black Army
		flavor_tim.1			#Death of Shah Rukh
		muslim_school_events.20 #No Religious School
		flavor_daimyo.4			#Shiba Yoshikado
		flavor_fra.9000			# Fran√ßois Villon
		flavor_sca.2			# Education Focus of the new Ruler
		flavor_rus.128			# Peter the Great
		flavor_rus.131			# Streltsy Payment
		flavor_gbr.102			# Religious Stance of the King
		
		christian_school_events.20 #no rite
		eastern_school_events.20
		christian_school_events.21 #no reformed denomination				  
													  
	}
	random_events = {
		1000 = 0
		100 = flavor_kol.1		# Bavarian Archbishop
		100 = flavor_hsa.3		# Hansa: Tagfahrt
		100 = inti_events.1		# Birth of a Panaca
		50 = dynastic_events.4
		50 = dynastic_events.5
		25 = harem_events.7		#Failed Policy of Fratricide
	}
}

# country
on_monarch_death = {
	if = {
		limit = {
			tag = ANS
			BRA = {
				has_country_flag = albrecht_achilles_flag
			}
		}
		BRA = {
			clr_country_flag = albrecht_achilles_flag #Just to be sure
			kill_heir = {} #If Albrecht Achilles dies in Ansbach he will also be dead in Brandenburg, will appear as normal death of heir to BRA.
		}
	}
	if = {
		limit = { has_country_modifier = sought_after_bachelor }
		remove_country_modifier = sought_after_bachelor
	}
	if = {
		limit = {
			tag = SAX
			has_country_flag = sax_thuringen_split_to_happen
			OR = {
				NOT = { dynasty = "von Wettin" }
				NOT = { senior_union_with = THU }
				has_regency = yes
			}
		}
		clr_country_flag = sax_thuringen_split_to_happen
	}
	if = {
		limit = { tag = SAM }
		country_event = { id = polynesian.35 }
	}
	if = {
		limit = { tag = TOG }
		country_event = { id = polynesian.36 }
	}
	if = {	# Ascension of Trailokanat	
		limit = { tag = AYU }
		country_event = { id = flavor_suk.1 }
	}									  
	if = {
		limit = { tag = GOT }
		country_event = { id = flavor_got.37 }				 
	}
	if = {
		limit = { has_government_attribute = no_stability_loss_on_monarch_death }
		add_stability = 1
	}
	
	#GK
	if = {
		limit = {
			religious_school = {
				group = eastern
				school = mr_akanya_sutta_school
			}
			NOT = { has_country_modifier = aks_reelect }
		}
		country_event = { id = eastern_school_events.21 }
	}
	if = { #Triggers Western Schism
		limit = { tag = PAP }
		country_event = { id = mr_catholic.1 }
	}
	if = { #starts the Blue Horde/Bulgaria Conflict
		limit = { tag = BLH }
		country_event = { id = blue_horde_flavor.1 }
	}
	
	
	
	burgundian_inheritance_start_effect = yes
	ladislaus_postumus_king_died_effect = yes
	joan_de_trastamara_king_died_effect = yes
	events = {
		flavor_wal.1 # Vlad the Impaler. So that he doesn't try to usurp his father.
		flavor_nav.4 # Navarra succession event
		flavor_sax.8 # Treaty of Leipzig
		flavor_pap.16 # Borgia Pope
		flavor_pap.19 # death of borgia pope
		flavor_tus.22 # Medici Pope
		flavor_tus.24 # death of the Medici Pope
		majapahit.8 # Majapahit pretenders
		flavor_mal.11 # Mali pretenders
		flavor_mal.47 # Pilgrimage ends prematurely
		government_events.3	# Election of a new Ruler
	}
}

on_mandate_of_heaven_gained = {
	save_global_event_target_as = EmperorOfChina
	if = {
		limit = {
			technology_group = nomad_group
		}
		change_technology_group = chinese
		change_unit_type = chinese
	}
	if = {
		limit = { 
			has_dlc = "Domination" 
			NOT = { primary_culture = mongol }
			NOT = { primary_culture = chahar }
			NOT = { primary_culture = khalkha }
			NOT = { primary_culture = oirats }
		}
		swap_non_generic_missions = yes 
	}
	if = {
		limit = {
			OR = {
				NOT = { government = monarchy }
				NOT = { tag = GSC }
				government = tribal
			}
		}
		change_government_to_monarchy = yes
	}
	if = {
		limit = {
			not = { tag = GSC }
		}
		add_government_reform = celestial_empire
	}
	if = {
		limit = {
			tag = GSC
		}
		add_government_reform = empire_of_light_reform
	}
	set_mandate = 60
	set_meritocracy = 60
	add_country_modifier = {
		name = new_mandate_holder
		duration = 9125
	}
	1816 = {
		if = {
			limit = {
				NOT = { owned_by = root }
				NOT = { is_core = root }
			}
			add_core = root
		}
	}
	1821 = {
		if = {
			limit = {
				NOT = { owned_by = root }
				NOT = { is_core = root }
			}
			add_core = root
		}
	}
	667 = {
		if = {
			limit = {
				NOT = { owned_by = root }
				NOT = { is_core = root }
			}
			add_core = root
		}
	}
	china_superregion = {
		limit = {
			NOT = { is_core = ROOT }
		}
		add_permanent_claim = ROOT
	}
	if = {
		limit = {
			has_dlc = "Mandate of Heaven"
		}
		remove_faction = temples
		remove_faction = enuchs
		remove_faction = bureaucrats
	}
	if = {
		limit = {
			has_country_modifier = lost_mandate_of_heaven
		}
		remove_country_modifier = lost_mandate_of_heaven
	}
	country_event = { #Reforming the Bureaucracy
		id = china_events.31
		days = 365
	}
	country_event = {
		id = china_events.32 #Records of the last Empire
		days = 183
	}
	country_event = {
		id = celestial_empire_events.2
		days = 1825
	}
}

on_bi_yearly_pulse_3 = {

	#Fire estate agenda if you have that privilege
	# NOTE DOING THIS THROUGH RANDOM EVENT NOW WITH estate_privileges_and_agendas_events.4 INSTEAD!
	#on_bi_yearly_pulse_estate_privileges_effect = yes

	events = {
		muslim_school_events.20 #Pick School
		christian_school_events.20 #pick christian rite
		eastern_school_events.20
		christian_school_events.21 #pick reformed denomination
		MRestate_privileges_and_agendas_events.5
	}
	random_events = {
		100 = new_court_flavour_events.25 #blood is thicker than water
		200 = 0
	}
}

on_battle_won_country = {
	#on_battle_ended_effect = yes
	on_battle_won_country_effect = yes
	if = {
		limit = {
			ROOT = {
				tag = ALB
				NOT = { has_country_flag = albanian_victory }
			}
			FROM = {
				tag = TUR
			}
		}
		ROOT = { set_country_flag = albanian_victory }
	}
	count_won_battles_and_reward_at_end = {
		counting_flag = teu_crusader_battle_counter
		max_value = 20
		effect = "
			country_event = {
				id = flavor_teu.12
			}
		"
	}
	count_won_battles_and_reward_at_end = {
		counting_flag = has_rus_kill_counter
		max_value = 40
		effect = "set_country_flag = rus_finished_kill_mission"
	}
	if = {
		limit = {
			ROOT = {
				has_reform = MR_thai_tributary
			}
		}
		add_karma = 1
	}
}

# country
# root = winning country, from = location
on_siege_won_country = {
	if = {
		limit = {
			from = { owned_by = SAX }
			OR = {
				is_in_war = {
					defenders = root
					defenders = THU
					defenders = emperor
					attackers = SAX
				}
				is_in_war = {
					attackers = root
					attackers = THU
					attackers = emperor
					defenders = SAX
				}
			}
			THU = {
				dynasty = "von Wettin"
				is_elector = no
				is_emperor = no
				alliance_with = emperor
			}
			SAX = {
				is_elector = yes
				all_owned_province = {
					NOT = { controlled_by = SAX }
					OR = {
						controlled_by = THU
						controller = {
							OR = {
								is_in_war = {
									defenders = this
									defenders = THU
									defenders = emperor
									attackers = SAX
								}
								is_in_war = {
									attackers = this
									attackers = THU
									attackers = emperor
									defenders = SAX
								}
							}
						}
					}
				}
			}
		}
		THU = { country_event = { id = flavor_sax.10 } } # Ask Emperor for Saxon Electorate
	}
	if = {
		limit = {  
			FROM = { has_government_mechanic = abyssinian_unity_mechanic }
			ROOT = { tag = REB }
		}	
		add_government_power = { mechanic_type = abyssinian_unity_mechanic power_type = abyssinian_unity_power value = -2 }
	}
	if = {
		limit = {
			ROOT = {
				religion = jewish
				has_church_aspect = judaism_remember_passover_aspect
			}
			FROM = {
				owner = {
					war_with = ROOT
				}
				fort_level = 1
			}
		}
		ROOT = {
			add_church_power = 5
		}
	}
	grant_manpower_from_capital_slave_raid = yes
	if = {
		limit = {
			ROOT = {
				has_country_flag = kill_mahayana_flag
			}
			FROM = {
				province_id = 1020
			}
		}
		1020 = {
			add_devastation = 35
		}
		ROOT = {
			clr_country_flag = kill_mahayana_flag
		}
	}
	events = {
		tyw_events.14 # Fall of Prague in Religious War
		flavor_oir.5 # Oirats capture Beijing
		flavor_lna.1 # Emerald Buddha
		flavor_son.14 # Djenne surrenders to Songhai Trigger
		flavor_teu.25 # Payback for the Hussite Wars
		flavor_tur.240 # Collapse of teh Mamluks
		flavor_kor.16 # Tripitaka Koreana
		flavor_tur.211 # Fall of Vienna
	}
	random_events = {
		10 = army_professionalism_events.1 #City Sacked
		100 = 0
	}
}
# province
on_adm_development = {
	on_adm_development_effect = yes
	if = {
		limit = { owner = { has_country_flag = enable_supplemental_development_flag } }
		random_list = {
			20 = { add_base_tax = 1 }
			80 = { }
		}
	}
	if = {
		limit = { 
			owner = { has_country_modifier = lit_increased_dev_modifier }
		}
		add_base_tax = 1 
	}
	if = { 
		limit = { has_state_edict = chinese_industrialization } 
		random_list = {
			10 = { add_base_tax = 1 } 
			10 = { add_prosperity = 1 } 
			10 = { add_province_modifier = { name = qng_center_of_industrialization_modifier duration = 3650 } }
			70 = {  } 
		}
	}
	if = {
		limit = { owner = { has_country_modifier = JAP_cadastral_surveys has_dlc = "Domination" } }
		owner = {
			change_estate_land_share = {
				estate = all 
				share = -0.2
			}
		}
	}
	
	if = {
		limit = { owner = { has_country_modifier = jap_20_years_devving_tax_yields_twice_bonus_1_burgher_loyalt_modifier } }
		add_base_tax = 1 
		owner = {
			add_estate_loyalty = {
				estate = estate_burghers 
				loyalty = 1 
			}
		}
	}
	
	if = { 
		limit = { 
			owner = { has_country_modifier = pru_victory_lower_saxony_modifier }
			OR = { 
				culture = saxon
				culture = lower_saxon
			}
		}
		add_nationalism = -3
		add_local_autonomy = -5
		add_prosperity = 1
	}
	#G&K
	if = {
		limit = {
			owner = { mission_completed = mr_sicily_italy_8 }
			OR = {
				area = western_sicily_area
				area = sicily_area
				area = naples_area
				area = calabria_area
				area = apulia_area
			}
		}
		random_list = { 
			20 = { add_base_tax = 1 } 
			80 = { } 
		}
	}
}

# province
on_dip_development = {
	on_dip_development_effect = yes

	if = { 
		limit = { 
			owner = { has_country_modifier = pru_victory_lower_saxony_modifier }
			OR = { 
				culture = saxon
				culture = lower_saxon
			}
		}
		add_nationalism = -3
		add_local_autonomy = -5
		add_prosperity = 1
	}
	#G&K
	if = {
		limit = {
			owner = { mission_completed = mr_sicily_italy_8 }
			OR = {
				area = western_sicily_area
				area = sicily_area
				area = naples_area
				area = calabria_area
				area = apulia_area
			}
		}
		random_list = { 
			20 = { add_base_production = 1 } 
			80 = { } 
		}
	}

}

# province
on_mil_development = {
	on_mil_development_effect = yes

	if = { 
		limit = { 
			owner = { has_country_modifier = pru_victory_lower_saxony_modifier }
			OR = { 
				culture = saxon
				culture = lower_saxon
			}
		}
		add_nationalism = -3
		add_local_autonomy = -5
		add_prosperity = 1
	}
	#G&K
	if = {
		limit = {
			owner = { mission_completed = mr_sicily_italy_8 }
			OR = {
				area = western_sicily_area
				area = sicily_area
				area = naples_area
				area = calabria_area
				area = apulia_area
			}
		}
		random_list = { 
			20 = { add_base_manpower = 1 } 
			80 = { } 
		}
	}
}
on_culture_promoted = {
	on_culture_promoted_estate_privileges_effect = yes
	judaism_on_culture_country_effect = yes
	imperial_modifiers_on_culture_country_effect = yes
	
	if = { 
		limit = { has_country_flag = reduce_ae_from_prom_cultures_flag }
		every_country = {
			add_aggressive_expansion = {
				who = ROOT 
				value = -3
				apply_calc = no 
			}
		}
	}
	if = {
		limit = { has_government_mechanic = abyssinian_unity_mechanic }
		add_government_power = { mechanic_type = abyssinian_unity_mechanic power_type = abyssinian_unity_power value = 10 }
	}
}
on_culture_demoted = {
	on_culture_demoted_estate_privileges_effect = yes
	judaism_on_culture_country_effect = yes
	imperial_modifiers_on_culture_country_effect = yes
	on_culture_demoted_effect = yes
	if = {
		limit = { has_government_mechanic = abyssinian_unity_mechanic }
		add_government_power = { mechanic_type = abyssinian_unity_mechanic power_type = abyssinian_unity_power value = -25 }
	}
}
# province
on_province_religion_converted = {
	on_province_religion_changed_effect = yes
	on_province_religion_converted_effect = yes
	if = {
		limit = { 
			owner = { 
				has_government_attribute = more_25_tax_in_true_faith_provinces
			}
			religion_group = owner 
			NOT = { has_province_modifier = ottoman_siyasah_tax_reform_tax }
		}
		add_province_modifier = {
			name = ottoman_siyasah_tax_reform_tax
			duration = -1
		}
	}
	if = {
		limit = {
			OR = {
				NOT = { 
					owner = { has_government_attribute = more_25_tax_in_true_faith_provinces } 
				}
				NOT = { religion_group = owner }
			}
			has_province_modifier = ottoman_siyasah_tax_reform_tax
		}
		remove_province_modifier = ottoman_siyasah_tax_reform_tax
	}
	if = {
		limit = { 
			owner = { 
				has_government_attribute = more_15_manpower_in_heathen_provinces
			}
			NOT ={ religion_group = owner }
			NOT = { has_province_modifier = ottoman_siyasah_tax_reform_manpower }
		}
		add_province_modifier = {
			name = ottoman_siyasah_tax_reform_manpower
			duration = -1
		}
	}
	if = {
		limit = {
			OR = {
				NOT = { 
					owner = { has_government_attribute = more_15_manpower_in_heathen_provinces } 
				}
				religion_group = owner 
			}
			has_province_modifier = ottoman_siyasah_tax_reform_manpower
		}
		remove_province_modifier = ottoman_siyasah_tax_reform_manpower
	}
	if = {
		limit = {  
			owner = { has_government_mechanic = abyssinian_unity_mechanic }
			OR = {
				has_owner_accepted_culture = yes 
				has_owner_culture = yes
			}
		}
		add_government_power = { mechanic_type = abyssinian_unity_mechanic power_type = abyssinian_unity_power value = 0.5 }
	}
}
on_province_owner_change = {
	events = {
		japan.1			#Fall of the current Shogun
		flavor_tur.207	#Victory over the Knights
	}
	on_province_owner_change_government_effect = yes

	if = {
		limit = {
			owned_by = SRU
			exists = ARA
		}
		ARA = {
			set_country_flag = ARA_defeat_saruhan
		}
	}
	if = {
		limit = {
			NOT = { owner = { religion_group = muslim } }
			has_province_modifier = sufi_shrine
		}
		remove_province_modifier = sufi_shrine
	}
	on_province_owner_change_estate_privileges_effect = yes
	imperial_modifiers_on_province_change_culture_or_change_owner_effect = yes
	
	if = {
		limit = {
			region = indo_china_region
			has_building = farm_estate
			trade_goods = grain
			owner = {
				has_mission = mnd_khm_irrigation 
				NOT = {
					OR = {
						has_estate = estate_vaisyas
						has_estate = estate_burghers
					}
				}
			}
		}
		add_province_modifier = {
			name = grain_production_improved
			duration = 7300
		}
	}

	if = {
		limit = {
			trade_goods = gold
			NOT = { has_province_modifier = estate_burghers_control_over_gold_mine }
			owner = {
				has_estate_privilege = estate_burghers_control_over_the_mint
				NOT = { owner = { mission_completed =  mr_ifat_tall_7 } }
			}
		}
		add_province_modifier = {
			name = estate_burghers_control_over_gold_mine
			duration = -1
		}
	}
	
	if = {
		limit = {
			province_id = 379
			owner = {
				NOT = { religion = jewish }
			}
		}
		remove_country_modifier = third_temple_country_modifier
	}
	if = {
		limit = {
			owner = {
				has_country_modifier = son_fetishism_as_secondary_religion
			}
			religion = shamanism
			NOT = { has_province_modifier = son_fetishism_as_secondary_religion_province }
		}
		add_province_modifier = {
			name = son_fetishism_as_secondary_religion_province
			duration = -1
			desc = son_fetishism_as_secondary_religion_province_desc
		}
	}
	else_if = {
		limit = {
			OR = {
				owner = {
					NOT = { has_country_modifier = son_fetishism_as_secondary_religion }
				}
				NOT = { religion = shamanism }
			}
			has_province_modifier = son_fetishism_as_secondary_religion_province
		}
		remove_province_modifier = son_fetishism_as_secondary_religion_province
	}
	if = { 
		limit = { 
			owner = { NOT = { has_reform = jap_gokaido_reform } }
		}
		remove_province_modifier = jap_gokaido_modifier
	}
	if = {
		limit = { 
			owner = { 
				has_government_attribute = more_15_manpower_in_heathen_provinces
			}
			NOT ={ religion_group = owner }
			NOT = { has_province_modifier = ottoman_siyasah_tax_reform_manpower }
		}
		add_province_modifier = {
			name = ottoman_siyasah_tax_reform_manpower
			duration = -1
		}
	}
	if = {
		limit = { 
			owner = { 
				has_government_attribute = more_15_manpower_in_heathen_provinces
			}
			NOT ={ religion_group = owner }
			NOT = { has_province_modifier = ottoman_siyasah_tax_reform_manpower }
		}
		add_province_modifier = {
			name = ottoman_siyasah_tax_reform_manpower
			duration = -1
		}
	}
}


# Fixes trade goods changing T2 good's deleting manufactories
# ROOT = province, FROM = country
on_trade_good_changed = {
	on_trade_good_changed_estate_privileges_effect = yes
	on_trade_good_changed_government_effect = yes
	ROOT = {
		if = {
			limit = { 
				trade_goods = coal 
				FROM = { economic_ideas = 3 }
				has_manufactory_trigger = yes 
				base_production = 2
			}
		}
		add_base_production = -1 
	}
	
	# ###MR
	ROOT = {
		if = {
			limit = {
				has_t2_goods = no
				has_t2_goods_manufactory = yes
			}
			remove_t2_manufactory = yes
			if = {
				limit = { trade_goods = alcohol }
				change_trade_goods = grain
			}
			else_if = {
				limit = { trade_goods = honey_wine }
				change_trade_goods = honey
			}
			else_if = {
				limit = { trade_goods = rum }
				change_trade_goods = sugar
			}
			else_if = {
				limit = { trade_goods = cheese }
				change_trade_goods = livestock
			}
			else_if = {
				limit = { has_province_flag = was_wool_province }
				change_trade_goods = wool
				clr_province_flag = was_wool_province
			}
			else_if = {
				limit = { has_province_flag = was_cotton_province }
				change_trade_goods = cotton
				clr_province_flag = was_cotton_province
			}
			else_if = {
				limit = { trade_goods = steel }
				change_trade_goods = iron
			}
			else_if = {
				limit = { has_province_flag = was_ivory_province }
				change_trade_goods = ivory
				clr_province_flag = was_ivory_province
			}
			else_if = {
				limit = { has_province_flag = was_gems_province }
				change_trade_goods = gems
				clr_province_flag = was_gems_province
			}
			else_if = {
				limit = { trade_goods = chocolate }
				change_trade_goods = cocoa
			}
			else_if = {
				limit = { trade_goods = naval_supplies }
				change_trade_goods = lumber
			}
			else_if = {
				limit = { trade_goods = rice_wine }
				change_trade_goods = rice
			}
			else_if = {
				limit = { trade_goods = wine }
				change_trade_goods = grapes
			}
			else_if = {
				limit = { trade_goods = gunpowder }
				change_trade_goods = sulfur
			}
			else_if = {
				limit = { trade_goods = military_supplies }
				change_trade_goods = gunpowder
			}
		}
	}
}
